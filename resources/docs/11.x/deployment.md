# Розгортання

- [Вступ](#introduction)
- [Вимоги до сервера](#server-requirements)
- [Конфігурація сервера](#server-configuration)
    - [Nginx](#nginx)
- [Оптимізація](#optimization)
    - [Налаштування кешування](#optimizing-configuration-loading)
    - [Події кешування](#caching-events)
    - [Маршрути кешування](#optimizing-route-loading)
    - [Кешування переглядів](#optimizing-view-loading)
- [Режим налагодження](#debug-mode)
- [Маршрут здоров'я](#the-health-route)
- [Просте розгортання за допомогою Forge / Vapor](#deploying-with-forge-or-vapor)

<a name="introduction"></a>
## Вступ

Коли ви будете готові до розгортання вашого додатку Laravel на виробництві, є кілька важливих речей, які ви можете зробити, щоб переконатися, що ваш додаток працює максимально ефективно. У цьому документі ми розглянемо декілька важливих відправних точок для забезпечення належного розгортання вашого додатку Laravel.

<a name="server-requirements"></a>
## Вимоги до сервера

Фреймворк Laravel має декілька системних вимог. Ви повинні переконатися, що ваш веб-сервер має наступну мінімальну версію PHP та розширення:

<div class="content-list" markdown="1">

- PHP >= 8.2
- Ctype PHP Extension
- cURL PHP Extension
- DOM PHP Extension
- Fileinfo PHP Extension
- Filter PHP Extension
- Hash PHP Extension
- Mbstring PHP Extension
- OpenSSL PHP Extension
- PCRE PHP Extension
- PDO PHP Extension
- Session PHP Extension
- Tokenizer PHP Extension
- XML PHP Extension

</div>

<a name="server-configuration"></a>
## Конфігурація сервера

<a name="nginx"></a>
### Nginx

Якщо ви розгортаєте свій додаток на сервері, який працює під управлінням Nginx, ви можете використовувати наступний конфігураційний файл як відправну точку для налаштування вашого веб-сервера. Швидше за все, цей файл потрібно буде налаштувати в залежності від конфігурації вашого сервера. **Якщо вам потрібна допомога в управлінні вашим сервером, розгляньте можливість використання сторонніх сервісів управління і розгортання серверів Laravel, таких як [Laravel Forge](https://forge.laravel.com).**

Будь ласка, переконайтеся, що ваш веб-сервер спрямовує всі запити до файлу `public/index.php вашого додатку, як у наведеній нижче конфігурації. Ніколи не намагайтеся перемістити файл `index.php` в корінь вашого проекту, оскільки запуск програми з кореня проекту призведе до того, що багато конфіденційних конфігураційних файлів стануть доступними для загального доступу в Інтернеті:

```nginx
server {
    listen 80;
    listen [::]:80;
    server_name example.com;
    root /srv/example.com/public;

    add_header X-Frame-Options "SAMEORIGIN";
    add_header X-Content-Type-Options "nosniff";

    index index.php;

    charset utf-8;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location = /favicon.ico { access_log off; log_not_found off; }
    location = /robots.txt  { access_log off; log_not_found off; }

    error_page 404 /index.php;

    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php8.2-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        include fastcgi_params;
    }

    location ~ /\.(?!well-known).* {
        deny all;
    }
}
```

<a name="optimization"></a>
## Оптимізація

Під час розгортання вашого додатку у виробництво, існує безліч файлів, які слід кешувати, включаючи вашу конфігурацію, події, маршрути та подання. Laravel надає єдину зручну команду `optimize` Artisan, яка кешує всі ці файли. Цю команду зазвичай слід викликати як частину процесу розгортання вашого додатку:

```shell
php artisan optimize
```

Метод `optimize:clear` може бути використано для видалення усіх файлів кешу, згенерованих командою `optimize`:

```shell
php artisan optimize:clear
```

У наступній документації ми обговоримо кожну з команд гранулярної оптимізації, які виконуються командою `optimize`.

<a name="optimizing-configuration-loading"></a>
### Налаштування кешування

Під час розгортання вашої програми у виробництво вам слід переконатися, що ви виконуєте команду `config:cache` Artisan під час процесу розгортання:

```shell
php artisan config:cache
```

Ця команда об'єднає всі конфігураційні файли Laravel в один кешований файл, що значно зменшить кількість звернень фреймворку до файлової системи при завантаженні значень конфігурації.

> [!WARNING]  
> Якщо ви виконуєте команду `config:cache` під час процесу розгортання, ви повинні бути впевнені, що викликаєте функцію `env` тільки з ваших конфігураційних файлів. Після кешування конфігурації файл `.env` не буде завантажено і всі виклики функції `env` для змінних `.env` повертатимуть значення `null`.

<a name="caching-events"></a>
### Події кешування

Під час процесу розгортання вам слід кешувати автоматично виявлені події вашого додатка у зіставленнях слухачів. Це можна зробити за допомогою виклику команди `event:cache` Artisan під час розгортання:

```shell
php artisan event:cache
```

<a name="optimizing-route-loading"></a>
### Маршрути кешування

Якщо ви створюєте велику програму з багатьма маршрутами, вам слід переконатися, що ви виконуєте команду `route:cache` Artisan під час процесу розгортання:

```shell
php artisan route:cache
```

Ця команда зводить усі ваші реєстрації маршрутів до одного виклику методу у кешованому файлі, покращуючи продуктивність реєстрації маршрутів при реєстрації сотень маршрутів.

<a name="optimizing-view-loading"></a>
### Кешування переглядів

Під час розгортання вашої програми у виробництво вам слід переконатися, що ви виконуєте команду `view:cache` Artisan під час процесу розгортання:

```shell
php artisan view:cache
```

Ця команда попередньо компілює всі ваші подання Blade, щоб вони не компілювалися на вимогу, покращуючи продуктивність кожного запиту, який повертає подання.

<a name="debug-mode"></a>
## Режим налагодження

Параметр debug у вашому конфігураційному файлі `config/app.php` визначає, скільки інформації про помилку буде показано користувачеві. За замовчуванням ця опція встановлена на значення змінної оточення `APP_DEBUG`, яка зберігається у файлі `.env` вашого додатку.

> [!WARNING]  
> **У вашому виробничому середовищі це значення завжди має бути `false`. Якщо змінна `APP_DEBUG` має значення `true` у виробничому середовищі, ви ризикуєте відкрити чутливі значення конфігурації для кінцевих користувачів вашого додатка.**

<a name="the-health-route"></a>
## Маршрут здоров'я

Laravel містить вбудований маршрут перевірки працездатності, який можна використовувати для моніторингу стану вашого додатку. У виробництві цей маршрут може бути використаний для повідомлення про стан вашого додатку монітору безвідмовної роботи, балансувальнику навантаження або системі оркестрування, такій як Kubernetes.

За замовчуванням маршрут перевірки стану обслуговується за адресою `/up` і повертає HTTP-відповідь 200, якщо програма завантажилася без винятків. В іншому випадку буде повернуто 500 HTTP-відповідь. Ви можете налаштувати URI для цього маршруту у файлі `bootstrap/app` вашої програми:

    ->withRouting(
        web: __DIR__.'/../routes/web.php',
        commands: __DIR__.'/../routes/console.php',
        health: '/up', // [tl! remove]
        health: '/status', // [tl! add]
    )

Коли HTTP-запити надходять за цим маршрутом, Laravel також надсилає подію `Illuminate\Foundation\Events\DiagnosingHealth`, що дозволяє вам виконувати додаткові перевірки стану здоров'я, які стосуються вашого додатку. Протягом [listener](/docs/{{version}}/events) для цієї події ви можете перевірити стан бази даних або кешу вашої програми. Якщо ви виявили проблему з вашим додатком, ви можете просто згенерувати виключення зі слухача.

<a name="deploying-with-forge-or-vapor"></a>
## Просте розгортання за допомогою Forge / Vapor

<a name="laravel-forge"></a>
#### Laravel Forge

Якщо ви не зовсім готові керувати власною конфігурацією сервера або вам незручно налаштовувати всілякі служби, необхідні для запуску надійного додатку Laravel, [Laravel Forge](https://forge.laravel.com) це чудова альтернатива.

Laravel Forge може створювати сервери на різних постачальниках інфраструктури, таких як DigitalOcean, Linode, AWS тощо. Крім того, Forge встановлює та керує всіма інструментами, необхідними для створення надійних додатків на Laravel, такими як Nginx, MySQL, Redis, Memcached, Beanstalk тощо.

> [!NOTE]  
> Хочете отримати повний посібник з розгортання за допомогою Laravel Forge? Ознайомтеся зі статтею [Laravel Bootcamp](https://bootcamp.laravel.com/deploying) і Forge [video series available on Laracasts](https://laracasts.com/series/learn-laravel-forge-2022-edition).

<a name="laravel-vapor"></a>
#### Laravel Vapor

Якщо вам потрібна повністю безсерверна платформа розгортання з автоматичним масштабуванням, налаштована для Laravel, ознайомтеся з [Laravel Vapor](https://vapor.laravel.com). Laravel Vapor - це безсерверна платформа для розгортання Laravel на базі AWS. Запустіть свою інфраструктуру Laravel на Vapor і полюбите масштабовану простоту безсерверної системи. Творці Laravel Vapor досконало налаштували Laravel для безперебійної роботи з фреймворком, щоб ви могли продовжувати писати свої додатки на Laravel так само, як ви звикли.
