# Розгортання

- [Вступ](#introduction)
- [Вимоги до сервера](#server-requirements)
- [Конфігурація сервера](#server-configuration)
    - [Nginx](#nginx)
    - [FrankenPHP](#frankenphp)
    - [Дозволи каталогів](#directory-permissions)
- [Оптимізація](#optimization)
    - [Налаштування кешування](#optimizing-configuration-loading)
    - [Події кешування](#caching-events)
    - [Маршрути кешування](#optimizing-route-loading)
    - [Кешування представлень](#optimizing-view-loading)
- [Режим налагодження](#debug-mode)
- [Маршрут здоров'я](#the-health-route)
- [Легке розгортання за допомогою Forge / Vapor](#deploying-with-forge-or-vapor)

<a name="introduction"></a>
## Вступ

Коли ви будете готові розгорнути свій додаток Laravel в експлуатаційному оточенні, ви повинні зробити кілька важливих речей, щоб переконатися, що ваш додаток працює максимально ефективно. У цій документації ми розглянемо кілька чудових відправних точок, щоб переконатися, що ваш додаток Laravel розгорнуто правильно.

<a name="server-requirements"></a>
## Вимоги до сервера

Фреймворк Laravel має кілька системних вимог. Ви маєте переконатися, що ваш веб-сервер має таку мінімальну версію PHP і розширення:

<!-- <div class="content-list" markdown="1"> -->

- PHP >= 8.2
- Розширення PHP Ctype
- Розширення PHP cURL
- Розширення PHP DOM
- Розширення PHP Fileinfo
- Розширення PHP Filter
- Розширення PHP Hash
- Розширення PHP Mbstring
- Розширення PHP OpenSSL
- Розширення PHP PCRE
- Розширення PHP PDO
- Розширення PHP Session
- Розширення PHP Tokenizer
- Розширення PHP XML

<!-- </div> -->

<a name="server-configuration"></a>
## Конфігурація сервера

<a name="nginx"></a>
### Nginx

Якщо ви розгортаєте свій додаток на сервері, на якому працює Nginx, то ви можете використовувати наступний конфігураційний файл як відправну точку для налаштування веб-сервера. Швидше за все, цей файл потрібно буде налаштувати залежно від конфігурації вашого сервера. **Якщо вам потрібна допомога в управлінні вашим сервером, розгляньте можливість використання власної служби управління та розгортання серверів Laravel, такої як [Laravel Forge](https://forge.laravel.com).**

Переконайтеся, що, як і в конфігурації нижче, ваш веб-сервер спрямовує всі запити до файлу `public/index.php` вашого додатка. Ви ніколи не повинні намагатися перемістити файл `index.php` у корінь вашого проєкту, оскільки обслуговування програми з кореня проєкту відкриє доступ до багатьох конфіденційних файлів конфігурації із загальнодоступної мережі Інтернет:

```nginx
server {
    listen 80;
    listen [::]:80;
    server_name example.com;
    root /srv/example.com/public;

    add_header X-Frame-Options "SAMEORIGIN";
    add_header X-Content-Type-Options "nosniff";

    index index.php;

    charset utf-8;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location = /favicon.ico { access_log off; log_not_found off; }
    location = /robots.txt  { access_log off; log_not_found off; }

    error_page 404 /index.php;

    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php8.2-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        include fastcgi_params;
        fastcgi_hide_header X-Powered-By;
    }

    location ~ /\.(?!well-known).* {
        deny all;
    }
}
```

<a name="frankenphp"></a>
### FrankenPHP

[FrankenPHP](https://frankenphp.dev/) також може використовуватися для обслуговування ваших додатків Laravel. FrankenPHP - це сучасний сервер додатків PHP, написаний на Go. Щоб обслуговувати PHP-додаток Laravel за допомогою FrankenPHP, ви можете просто викликати його команду `phphe-server`:

```shell
frankenphp php-server -r public/
```

Щоб скористатися потужнішими функціями, підтримуваними FrankenPHP, як-от інтеграція [Laravel Octane](/docs/{{version}}}/octane), HTTP/3, сучасне стиснення або можливість упаковувати додатки Laravel як автономні двійкові файли, зверніться до [документації Laravel](https://frankenphp.dev/docs/laravel/) FrankenPHP.

<a name="directory-permissions"></a>
### Дозволи для папок

Laravel знадобиться дозвіл на запис у каталоги `bootstrap/cache` і `storage`, тому вам слід переконатися, що у власника процесу веб-сервера є дозвіл на запис у ці каталоги.

<a name="optimization"></a>
## Оптимізація

Під час розгортання вашого додатка в робочому середовищі необхідно кешувати різні файли, включно з вашою конфігурацією, подіями, маршрутами та поданнями. Laravel надає єдину зручну команду Artisan `optimize`, яка кешує всі ці файли. Цю команду зазвичай слід викликати як частину процесу розгортання вашої програми:

```shell
php artisan optimize
```

Метод `optimize:clear` можна використовувати для видалення всіх файлів кешу, створених командою `optimize`, а також усіх ключів у драйвері кешу за замовчуванням:

```shell
php artisan optimize:clear
```

У наступній документації ми обговоримо кожну з команд детальної оптимізації, що виконуються командою `optimize`.

<a name="optimizing-configuration-loading"></a>
### Кешування конфігурації

Під час розгортання вашого застосунку в експлуатаційному оточенні, ви маєте переконатися, що ви виконали команду `config:cache` Artisan у процесі розгортання:

    php artisan config:cache

Ця команда об'єднає всі файли конфігурації Laravel в один кешований файл, що значно скоротить кількість звернень, які фреймворк повинен зробити до файлової системи під час завантаження значень вашої конфігурації.

> [!WARNING]
> Якщо ви виконуєте команду `config:cache` у процесі розгортання, ви маєте бути впевнені, що викликаєте функцію `env` тільки з ваших файлів конфігурації. Після кешування конфігурації файл `.env` не буде завантажуватися, і всі виклики функції `env` для змінних файлу `.env` повернуть `null`.
> 
<a name="caching-events"></a>
### Кешування подій

Вам слід кешувати автоматично виявлену подію вашої програми для зіставлення зі слухачами під час процесу розгортання. Це можна зробити, викликавши команду Artisan `event:cache` під час розгортання:

```shell
php artisan event:cache
```


<a name="optimizing-route-loading"></a>
### Оптимізація завантаження маршруту

Якщо ви створюєте великий застосунок із безліччю маршрутів, вам слід переконатися, що ви виконали команду `route:cache` Artisan у процесі розгортання:

```shell
php artisan route:cache
```

Ця команда скорочує реєстрацію всіх маршрутів до одного виклику методу в кешованому файлі, підвищуючи продуктивність під час реєстрації сотень маршрутів.

<a name="optimizing-view-loading"></a>
### Кешування подань

Під час розгортання вашого застосунку в експлуатаційному оточенні, ви маєте переконатися, що ви виконали команду `view:cache` Artisan у процесі розгортання:

```shell
php artisan view:cache
```

Ця команда попередньо скомпілює всі ваші шаблони Blade, щоб вони не компілювалися під час запиту, підвищуючи продуктивність кожного запиту, що повертає шаблон.

<a name="debug-mode"></a>
## Режим налагодження

Параметр налагодження у файлі конфігурації `config/app.php` визначає, скільки інформації про помилку фактично відображається користувачеві. За замовчуванням для цього параметра задано значення змінної середовища `APP_DEBUG`, яка зберігається у вашому файлі `.env`.

> [!WARNING]
> **У вашому експлуатаційному оточенні це значення завжди має бути `false`. Якщо значення для змінної `APP_DEBUG` встановлено як `true`, то ви ризикуєте розкрити конфіденційні значення конфігурації кінцевим користувачам вашого додатка.**

<a name="the-health-route"></a>
## Маршрут здоров'я

Laravel містить вбудований маршрут перевірки працездатності, який можна використовувати для відстеження статусу вашої програми. У виробничому середовищі цей маршрут можна використовувати для повідомлення про стан вашої програми монітору працездатності, балансувальнику навантаження або системі оркестрації, такій як Kubernetes.

За замовчуванням маршрут перевірки працездатності обслуговується за адресою `/up` і повертає HTTP-відповідь 200, якщо додаток завантажився без винятків. В іншому випадку буде повернуто HTTP-відповідь 500. Ви можете налаштувати URI для цього маршруту у файлі `bootstrap/app` вашого додатка:

    ->withRouting(
        web: __DIR__.'/../routes/web.php',
        commands: __DIR__.'/../routes/console.php',
        health: '/up', // [tl! удалить]
        health: '/status', // [tl! добавить]
    )

Під час виконання HTTP-запитів до цього маршруту Laravel також відправить подію `Illuminate\Foundation\Events\DiagnosingHealth\, що дасть змогу виконати додаткову перевірку стану, що має відношення до вашого застосунку. У межах [listener](/docs/{{version}}}/events) для цієї події можна перевірити стан бази даних або кешу вашого застосунку. Якщо ви виявите проблему з вашим додатком, ви можете просто згенерувати виняток зі слухача.

<a name="deploying-with-forge-or-vapor"></a>
## Розгортання за допомогою Forge / Vapor

<a name="laravel-forge"></a>
#### Laravel Forge

Якщо ви не зовсім готові керувати конфігурацією свого власного сервера або вам незручно налаштовувати всі різноманітні служби, потрібні для запуску надійного додатка Laravel, то [Laravel Forge](https://forge.laravel.com) - чудова альтернатива.

Laravel Forge може створювати сервери на різних постачальниках інфраструктури, таких як DigitalOcean, Linode, AWS та інших. Крім того, Forge встановлює та керує всіма інструментами, необхідними для створення надійних додатків Laravel, таких як Nginx, MySQL, Redis, Memcached, Beanstalk та інших.

> [!NOTE]  
> Хочете повний посібник із розгортання з використанням Laravel Forge? Перевірте [Laravel Bootcamp](https://bootcamp.laravel.com/deploying) і [відео-серію Forge на Laracasts](https://laracasts.com/series/learn-laravel-forge-2022-edition).

<a name="laravel-vapor"></a>
#### Laravel Vapor

Якщо вам потрібна повністю безсерверна платформа розгортання з автоматичним масштабуванням, налаштована для Laravel, ознайомтеся з [Laravel Vapor](https://vapor.laravel.com). Laravel Vapor - це платформа для безсерверного розгортання Laravel, що працює на AWS. Запустіть свою інфраструктуру Laravel на Vapor і закохайтеся в масштабовану простоту безсерверної архітектури. Laravel Vapor налаштований творцями Laravel для безперебійної роботи з фреймворком, тому ви можете продовжувати писати свої додатки Laravel саме так, як ви звикли.
